<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>Aplikasi Jadual Spesifikasi Ujian (JSU)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    input, textarea, select, button {
      margin: 5px 0;
      padding: 8px;
      width: 100%;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    .topik-row { display: flex; gap: 10px; margin-top: 5px; }
    .topik-row input { flex: 1; }
    .btn { margin-top: 10px; }
  </style>
</head>
<body>

  <h2>Aplikasi Jadual Spesifikasi Ujian (JSU)</h2>

  <label>Nama Kursus:</label>
  <input type="text" id="namaKursus">

  <label>Kod Kursus:</label>
  <input type="text" id="kodKursus">

  <label>Semester:</label>
  <input type="text" id="semester">

  <label>Tahun Pengajian:</label>
  <select id="tahunPengajian">
    <option value="1">Tahun 1</option>
    <option value="2">Tahun 2</option>
    <option value="3">Tahun 3</option>
    <option value="4">Tahun 4</option>
  </select>

  <label>Penyataan HPK:</label>
  <textarea id="hpk" rows="3"></textarea>

  <h3>Bahagian Topik dan Item</h3>
  <div id="senaraiTopik">
    <div class="topik-row">
      <input type="text" placeholder="Nama Topik">
      <input type="number" placeholder="Bil. Soalan">
      <input type="number" placeholder="Markah per Soalan">
      <button onclick="hapusBarisIni(this)">X</button>
    </div>
  </div>
  <button onclick="tambahTopik()">Tambah Topik</button>

  <h3>Peratus Tahap Kesukaran (Jumlah 100%)</h3>
  <label>C1 (Ingat):</label>
  <input type="number" id="C1" value="0">
  <label>C2 (Faham):</label>
  <input type="number" id="C2" value="0">
  <label>C3 (Aplikasi):</label>
  <input type="number" id="C3" value="0">

  <div class="btn">
    <button onclick="janaJSU()">Papar JSU</button>
    <button onclick="muatTurunWord()">Muat Turun Word</button>
    <button onclick="muatTurunExcel()">Muat Turun Excel</button>
    <button onclick="cetakJSU()">Cetak</button>
  </div>

  <div id="output"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    function tambahTopik() {
      const row = document.createElement('div');
      row.className = 'topik-row';
      row.innerHTML = `
        <input type="text" placeholder="Nama Topik">
        <input type="number" placeholder="Bil. Soalan">
        <input type="number" placeholder="Markah per Soalan">
        <button onclick="hapusBarisIni(this)">X</button>
      `;
      document.getElementById('senaraiTopik').appendChild(row);
    }

    function hapusBarisIni(btn) {
      btn.parentElement.remove();
    }

    function janaJSU() {
      const namaKursus = document.getElementById('namaKursus').value;
      const kodKursus = document.getElementById('kodKursus').value;
      const semester = document.getElementById('semester').value;
      const tahun = document.getElementById('tahunPengajian').value;
      const hpk = document.getElementById('hpk').value;

      const C1 = parseInt(document.getElementById('C1').value) || 0;
      const C2 = parseInt(document.getElementById('C2').value) || 0;
      const C3 = parseInt(document.getElementById('C3').value) || 0;
      const totalKesukaran = C1 + C2 + C3;

      if (totalKesukaran !== 100) {
        alert("Jumlah peratus kesukaran mesti 100%");
        return;
      }

      let output = `<h3>Jadual Spesifikasi Ujian</h3>`;
      output += `<p><strong>Nama Kursus:</strong> ${namaKursus}</p>`;
      output += `<p><strong>Kod Kursus:</strong> ${kodKursus}</p>`;
      output += `<p><strong>Semester:</strong> ${semester}</p>`;
      output += `<p><strong>Tahun Pengajian:</strong> ${tahun}</p>`;
      output += `<p><strong>HPK:</strong> ${hpk}</p>`;

      output += `<table>
        <tr><th>Topik</th><th>Bil. Soalan</th><th>Markah/Soalan</th><th>Jumlah Markah</th></tr>`;

      let jumlahSoalan = 0;
      let jumlahMarkah = 0;

      document.querySelectorAll("#senaraiTopik .topik-row").forEach(row => {
        const nama = row.children[0].value;
        const bil = parseInt(row.children[1].value) || 0;
        const markah = parseInt(row.children[2].value) || 0;
        const total = bil * markah;

        jumlahSoalan += bil;
        jumlahMarkah += total;

        output += `<tr>
          <td>${nama}</td>
          <td>${bil}</td>
          <td>${markah}</td>
          <td>${total}</td>
        </tr>`;
      });

      output += `<tr style="font-weight:bold">
        <td>Jumlah</td>
        <td>${jumlahSoalan}</td>
        <td>-</td>
        <td>${jumlahMarkah}</td>
      </tr>`;
      output += `</table>`;

      output += `<p><strong>Peratusan Tahap Kesukaran:</strong> C1: ${C1}%, C2: ${C2}%, C3: ${C3}%</p>`;

      document.getElementById('output').innerHTML = output;
    }

    function muatTurunWord() {
      const content = document.getElementById("output").innerHTML;
      const blob = new Blob(
        [`<html><head><meta charset='utf-8'></head><body>${content}</body></html>`],
        { type: "application/msword" }
      );
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "JSU.doc";
      link.click();
    }

    function cetakJSU() {
      const win = window.open("", "", "width=800,height=600");
      win.document.write("<html><head><title>JSU</title></head><body>");
      win.document.write(document.getElementById("output").innerHTML);
      win.document.write("</body></html>");
      win.document.close();
      win.focus();
      win.print();
      win.close();
    }

    function muatTurunExcel() {
      const table = document.createElement("table");
      table.innerHTML = document.getElementById("output").querySelector("table").innerHTML;
      const wb = XLSX.utils.table_to_book(table);
      XLSX.writeFile(wb, "JSU.xlsx");
    }
  </script>

</body>
</html>
