<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Aplikasi JSU</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    input, textarea, select, button {
      margin: 5px 0;
      padding: 5px;
      width: 100%;
    }
    .section {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    .btn {
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>Jadual Spesifikasi Ujian (JSU)</h1>

  <div class="section">
    <h3>1. Maklumat Kursus</h3>
    <input id="namaKursus" placeholder="Nama Kursus" />
    <input id="kodKursus" placeholder="Kod Kursus" />
    <input id="semester" placeholder="Semester" />
    <input id="tahun" placeholder="Tahun Pengajian" />
    <input id="pensyarah" placeholder="Nama Pensyarah" />
  </div>

  <div class="section">
    <h3>2. Hasil Pembelajaran Kursus (HPK)</h3>
    <textarea id="hpk" rows="4" placeholder="Salin tampal penyataan HPK dari RPS..."></textarea>
  </div>

  <div class="section">
    <h3>3. Topik & Item Soalan</h3>
    <table id="topikTable">
      <thead>
        <tr>
          <th>Topik</th>
          <th>Jenis Item</th>
          <th>Bil. Soalan</th>
          <th>Markah/Soalan</th>
          <th>Jumlah Markah</th>
          <th>Buang</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="tambahTopik()">Tambah Topik</button>
  </div>

  <div class="section">
    <h3>4. Peratus Tahap Kesukaran (Bloom)</h3>
    <input id="C1" placeholder="C1 (%)" type="number" />
    <input id="C2" placeholder="C2 (%)" type="number" />
    <input id="C3" placeholder="C3 (%)" type="number" />
    <input id="C4" placeholder="C4 (%)" type="number" />
    <input id="C5" placeholder="C5 (%)" type="number" />
    <input id="C6" placeholder="C6 (%)" type="number" />
  </div>

  <button class="btn" onclick="paparOutput()">Papar JSU</button>
  <button class="btn" onclick="muatTurunPDF()">PDF</button>
  <button class="btn" onclick="muatTurunExcel()">Excel</button>
  <button class="btn" onclick="muatTurunWord()">Word</button>
  <button class="btn" onclick="cetakJSU()">Cetak</button>

  <div id="output" class="section"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script>
    function tambahTopik() {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input class="topik" /></td>
        <td>
          <select class="item">
            <option>Objektif</option>
            <option>Struktur</option>
            <option>Esei</option>
          </select>
        </td>
        <td><input class="bilSoalan" type="number" min="1" /></td>
        <td><input class="markahSoalan" type="number" min="1" /></td>
        <td class="totalMarkah">0</td>
        <td><button onclick="this.parentElement.parentElement.remove()">X</button></td>
      `;
      row.querySelector('.bilSoalan').addEventListener("input", kiraMarkah);
      row.querySelector('.markahSoalan').addEventListener("input", kiraMarkah);
      document.querySelector("#topikTable tbody").appendChild(row);
    }

    function kiraMarkah() {
      const row = this.closest("tr");
      const bil = parseInt(row.querySelector('.bilSoalan').value) || 0;
      const markah = parseInt(row.querySelector('.markahSoalan').value) || 0;
      row.querySelector('.totalMarkah').innerText = bil * markah;
    }

    function paparOutput() {
      const output = document.getElementById("output");
      let html = `
        <h3>Maklumat Kursus</h3>
        <p><strong>${document.getElementById("namaKursus").value}</strong> (${document.getElementById("kodKursus").value})</p>
        <p>Semester: ${document.getElementById("semester").value}, Tahun: ${document.getElementById("tahun").value}</p>
        <p>Pensyarah: ${document.getElementById("pensyarah").value}</p>

        <h3>Hasil Pembelajaran Kursus (HPK)</h3>
        <p>${document.getElementById("hpk").value}</p>

        <h3>Jadual Topik & Soalan</h3>
        <table>
          <tr><th>Topik</th><th>Jenis Item</th><th>Bil. Soalan</th><th>Markah/Soalan</th><th>Jumlah Markah</th></tr>
      `;

      document.querySelectorAll("#topikTable tbody tr").forEach(row => {
        const t = row.querySelector(".topik").value;
        const i = row.querySelector(".item").value;
        const b = row.querySelector(".bilSoalan").value;
        const m = row.querySelector(".markahSoalan").value;
        const total = row.querySelector(".totalMarkah").innerText;
        html += `<tr><td>${t}</td><td>${i}</td><td>${b}</td><td>${m}</td><td>${total}</td></tr>`;
      });

      html += `</table><h3>Peratus Tahap Kesukaran</h3><ul>`;
      ["C1", "C2", "C3", "C4", "C5", "C6"].forEach(id => {
        html += `<li>${id}: ${document.getElementById(id).value}%</li>`;
      });
      html += "</ul>";
      output.innerHTML = html;
    }

    function muatTurunPDF() {
      const win = window.open("", "", "width=800,height=600");
      win.document.write(`<html><head><title>PDF</title></head><body>${document.getElementById("output").innerHTML}</body></html>`);
      win.document.close();
      win.focus();
      win.print();
    }

    function muatTurunExcel() {
      const table = document.createElement("table");
      table.innerHTML = document.getElementById("output").querySelector("table").outerHTML;
      const wb = XLSX.utils.table_to_book(table, { sheet: "JSU" });
      XLSX.writeFile(wb, "JSU.xlsx");
    }

    function muatTurunWord() {
      const html = document.getElementById("output").innerHTML;
      const blob = new Blob(
        [`<html><head><meta charset='utf-8'></head><body>${html}</body></html>`],
        { type: "application/msword" }
      );
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "JSU.doc";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function cetakJSU() {
      const printWin = window.open("", "", "width=800,height=600");
      printWin.document.write(`<html><head><title>Cetak JSU</title></head><body>${document.getElementById("output").innerHTML}</body></html>`);
      printWin.document.close();
      printWin.focus();
      printWin.print();
    }
  </script>

</body>
</html>
