<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>Jadual Spesifikasi Ujian (JSU)</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f7fa;
      padding: 30px;
    }
    h2, h3 {
      color: #333;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .btn {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #e9ecef;
    }
    .topik-card {
      background: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .topik-grid {
      display: flex;
      gap: 15px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .topik-grid > div {
      flex: 1;
      min-width: 150px;
    }
    .remove-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 8px 10px;
      border-radius: 6px;
      margin-top: 28px;
      cursor: pointer;
    }
    .remove-btn:hover {
      background-color: #b02a37;
    }
    .action-buttons button {
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h2>Jadual Spesifikasi Ujian (JSU)</h2>

  <label>Nama Kursus:</label>
  <input type="text" id="namaKursus">

  <label>Kod Kursus:</label>
  <input type="text" id="kodKursus">

  <label>Semester:</label>
  <input type="text" id="semester">

  <label>Tahun Pengajian:</label>
  <select id="tahunPengajian">
    <option value="1">Tahun 1</option>
    <option value="2">Tahun 2</option>
    <option value="3">Tahun 3</option>
    <option value="4">Tahun 4</option>
  </select>

  <label>Penyataan HPK:</label>
  <textarea id="hpk" rows="3"></textarea>

  <h3>Bahagian Topik dan Item</h3>
  <div id="senaraiTopik"></div>
  <button class="btn" onclick="tambahTopik()">+ Tambah Topik</button>

  <h3>Peratus Tahap Kesukaran (Jumlah 100%)</h3>
  <label>C1 (Ingat):</label>
  <input type="number" id="C1" value="0">
  <label>C2 (Faham):</label>
  <input type="number" id="C2" value="0">
  <label>C3 (Aplikasi):</label>
  <input type="number" id="C3" value="0">

  <div class="action-buttons">
    <button class="btn" onclick="janaJSU()">Papar JSU</button>
    <button class="btn" onclick="muatTurunWord()">Muat Turun Word</button>
    <button class="btn" onclick="muatTurunExcel()">Muat Turun Excel</button>
    <button class="btn" onclick="cetakJSU()">Cetak</button>
  </div>

  <div id="output"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    function tambahTopik() {
      const card = document.createElement('div');
      card.className = 'topik-card';
      card.innerHTML = `
        <div class="topik-grid">
          <div>
            <label>Nama Topik</label>
            <input type="text" placeholder="Contoh: Tajuk 1">
          </div>
          <div>
            <label>Bilangan Soalan</label>
            <input type="number" placeholder="Contoh: 3">
          </div>
          <div>
            <label>Markah/Soalan</label>
            <input type="number" placeholder="Contoh: 5">
          </div>
          <div>
            <button class="remove-btn" onclick="hapusBarisIni(this)">Buang</button>
          </div>
        </div>
      `;
      document.getElementById('senaraiTopik').appendChild(card);
    }

    function hapusBarisIni(btn) {
      btn.closest('.topik-card').remove();
    }

    function janaJSU() {
      const namaKursus = document.getElementById('namaKursus').value;
      const kodKursus = document.getElementById('kodKursus').value;
      const semester = document.getElementById('semester').value;
      const tahun = document.getElementById('tahunPengajian').value;
      const hpk = document.getElementById('hpk').value;
      const C1 = parseInt(document.getElementById('C1').value) || 0;
      const C2 = parseInt(document.getElementById('C2').value) || 0;
      const C3 = parseInt(document.getElementById('C3').value) || 0;

      if (C1 + C2 + C3 !== 100) {
        alert("Jumlah peratus tahap kesukaran mestilah 100%");
        return;
      }

      let output = `<h3>Jadual Spesifikasi Ujian</h3>`;
      output += `<p><strong>Nama Kursus:</strong> ${namaKursus}</p>`;
      output += `<p><strong>Kod Kursus:</strong> ${kodKursus}</p>`;
      output += `<p><strong>Semester:</strong> ${semester}</p>`;
      output += `<p><strong>Tahun Pengajian:</strong> ${tahun}</p>`;
      output += `<p><strong>HPK:</strong> ${hpk}</p>`;

      output += `<table><tr><th>Topik</th><th>Bil. Soalan</th><th>Markah/Soalan</th><th>Jumlah Markah</th></tr>`;
      let totalSoalan = 0;
      let totalMarkah = 0;

      document.querySelectorAll("#senaraiTopik .topik-card").forEach(card => {
        const input = card.querySelectorAll("input");
        const topik = input[0].value;
        const bil = parseInt(input[1].value) || 0;
        const markah = parseInt(input[2].value) || 0;
        const jumlah = bil * markah;

        totalSoalan += bil;
        totalMarkah += jumlah;

        output += `<tr><td>${topik}</td><td>${bil}</td><td>${markah}</td><td>${jumlah}</td></tr>`;
      });

      output += `<tr style="font-weight:bold">
        <td>Jumlah</td><td>${totalSoalan}</td><td>-</td><td>${totalMarkah}</td>
      </tr>`;
      output += `</table>`;

      output += `<p><strong>Peratus Tahap Kesukaran:</strong> C1: ${C1}%, C2: ${C2}%, C3: ${C3}%</p>`;
      document.getElementById('output').innerHTML = output;
    }

    function muatTurunWord() {
      const content = document.getElementById("output").innerHTML;
      const blob = new Blob([`<html><head><meta charset='utf-8'></head><body>${content}</body></html>`], { type: "application/msword" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "JSU.doc";
      link.click();
    }

    function cetakJSU() {
      const win = window.open("", "", "width=800,height=600");
      win.document.write("<html><head><title>JSU</title></head><body>");
      win.document.write(document.getElementById("output").innerHTML);
      win.document.write("</body></html>");
      win.document.close();
      win.focus();
      win.print();
      win.close();
    }

    function muatTurunExcel() {
      const table = document.createElement("table");
      table.innerHTML = document.getElementById("output").querySelector("table").innerHTML;
      const wb = XLSX.utils.table_to_book(table);
      XLSX.writeFile(wb, "JSU.xlsx");
    }

    // Mula dengan satu baris
    window.onload = tambahTopik;
  </script>

</body>
</html>
